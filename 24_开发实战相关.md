# 前端调试

## CSS调试

- **使用Elements面板**：通过Elements面板，可以实时查看和编辑页面的HTML和CSS，这对于调试布局问题、样式冲突或响应式设计尤为有用。您可以直接修改任何元素的CSS属性，并立即看到变化。
- **利用盒模型**：在Elements面板内，可以查看元素的盒模型信息，帮助理解元素的大小、填充、边框和外边距等。
- **颜色和布局预览**：DevTools可以预览颜色值和布局网格，帮助布局设计的微调。

## JavaScript调试

> 精确定位bug位置，分析原因、解决问题。

### 控制台报错

#### 出现报错

当接收到报错时，首先查看Console面板，它会显示错误消息、类型、堆栈跟踪和出错代码位置。

报错中需要关注的三类信息

- 报错信息：错误类型、提示文字
- 报错文件
- 报错行数

#### 定位问题位置

通过console输出的错误，会定位到源代码面板的出现错误的位置。

#### 分析错误类型

- `SyntaxError` - 语法错误
- `ReferenceError` -  引用错误，通常是变量或方法没有声明，直接使用
- `TypeError` -  类型错误，通常是在错误的数据类型上，访问某个方法或属性
- `RangeError` - 死循环

#### 逻辑分析

首先根据错误的类型，以及错误的提示信息，分析代码可能出现的问题，如果是明显的代码书写问题，我们就直接在源码上修改，然后再运行判断

#### 断点调试

给报错的相关位置，打上断点，运行程序，查看如下的信息：

- **Sources面板**：使用Sources面板进行断点调试。在代码中的关键位置设置断点，通过单步执行（Step Over/Into/Out），观察运行时变量和作用域链。
- **Call Stack边栏**：通过调用堆栈跟踪代码执行路径，理解错误是如何传递和触发的。
- **Watch边栏**：添加关键变量到Watch边栏，监控它们的值在不同执行点的变化。
- **Scope边栏**：查看当前断点的作用域中所有可用的变量和对象。

##### 断点分类

- 行断点

- **异常断点**：对于捕获的或未捕获的异常，设置异常断点，让代码在抛出异常时自动暂停。
- **日志断点（Log Breakpoints）**: 当代码执行到某个位置时，自动记录一条日志信息而不会暂停程序执行。
- **DOM断点**：
  - **子树修改（Subtree Modifications）**:
    - **场景**：当你想要监控一个DOM元素的子树发生变化时，比如子元素被添加或删除。
    - **触发**：在被监控的DOM元素或其子元素内部发生任何结构更改时触发。
  - **属性修改（Attribute Modifications）**:
    - **场景**：用于监听特定元素的属性变化，如`class`, `style`等属性被改变。
    - **触发**：当被监控元素的任何属性值发生改变时触发。
  - **节点移除（Node Removal）**:
    - **场景**：当你想知道特定元素何时被移出DOM树时使用。
    - **触发**：当被监控的DOM元素从其父元素中移除时触发。
- 事件断点
- URL请求断点

## 网络错误调试

网络错误主要是通过网络窗口来进行分析和调试的，一般来说，网络请求出现问题，会在网络面板提示。

### 确定问题来源方

> HTTP状态码：出现`4XX、5XX`

`4XX`：根据状态码和接口报错信息，修复代码。【前端问题】

`5XX`：提供调用数据，通知后台查看。【后端问题】

`2XX`：以预期数据与实际数据一致为准。

### 4xx状态码问题

>目标：`4XX`大概率是前端调用API出现问题，需要熟练结合 `Console` 和 `NetWork` 面板处理。

#### 定位问题

console面板会提示哪个请求出现的问题，我们可以根据链接，通过Network面板，查看对应的状态码，以及请求体和响应体的数据信息。

并且在console面板中还会显示对应的源码位置。

#### 解决问题

找到源码位置之后，我们分析状态码以及可能出现的原因，修改代码。

4xx的状态码大概有以下几种：

#### 400

描述：客户端请求的语法错误，服务器无法理解

原因：请求体传递参数不对。

解决方案：

1. NetWork查看请求体
2. 比对接口文档，
   1. 数据格式，是否一致。
   2. 属性名，是否一致。

#### 401

描述：请求要求用户的身份认证；

原因：token失效，请求头没有携带token。

解决方案：

1. 查看请求头，是否有token
2. 重新登录，验证token过期。

#### 404

描述：服务器无法根据客户端的请求找到资源（网页）

原因：没有该接口（通常是url路径写的有问题）

解决方案：

1. 查看请求头上的url路径
2. 核对接口文档的url路径

#### 405

描述：客户端请求中的方法被禁止；

原因：请求方式不对（通常是get  、post、put等方式写错）

1. 查看请求头中的method字段
2. 核对接口文档的method字段

### 5xx状态码问题

> 大概了解一下

> 目标：`5XX`表示服务器端出现问题，通常需要服务端进行检查和修复，前端可以尝试排除请求本身的问题，并联系后端开发者。

#### 定位问题

当请求失败且返回5xx响应代码时，首先在Network面板中查看失败的请求。检查请求的详情，包括请求头、请求方法、路径和查询字符串等，以确保请求本身没有问题。

同时，考虑查看服务器的日志文件，以获取进一步的错误详情。如果使用Node.js，服务端可能正在使用 `console.error` 打印错误消息，或者使用像 `morgan` 这样的日志库来记录HTTP请求。

#### 解决问题

由于5xx错误通常表明是服务器错误，前端开发者的解决措施有限，但还是可以采取以下步骤：

5xx的状态码大概有以下几种：

#### 500

描述：服务器内部错误，无法完成请求；

原因：服务器上运行的代码引发异常或其他问题。

解决方案（Node.js）：

1. 查看服务器日志，找出触发问题的代码。
2. 运行时检查代码段，可能包括异步操作或中间件。
3. 如果有堆栈跟踪，利用这些信息定位到具体的文件和代码行。
4. 如果问题仍然不清晰，使用调试工具或`console.log`打印出问题前后的相关变量状态。

#### 502

描述：作为网关或代理的服务器，从上游服务器收到了无效的响应；

原因：后端服务器的问题，或网关问题。

解决方案（Node.js）：

1. 确认所有的上游服务都在运行中，并且网络连接是健康的。
2. 检查反向代理设置（例如Nginx），确认代理转发正确无误。
3. 确认中间件或路由没有误操作头部信息，导致无效响应发送。

#### 503

描述：服务不可用。服务器目前无法使用（由于超载或停机维护），通常是暂时状态。

原因：服务器过载或维护。

解决方案（Node.js）：

1. 检查服务器的负载情况，查看是否存在资源瓶颈，如CPU或内存过高。
2. 了解部署的应用结构，比如是否有负载均衡器可以重新分配负载。
3. 如果服务器正在维护，请告知前端用户，并尝试提供维护结束的时间。

#### 504

描述：网关超时。作为网关或代理的服务器，未能及时从上游服务器或辅助服务器收到请求；

原因：一个服务器没有及时得到另一个服务器的响应。

解决方案（Node.js）：

1. 检查并确保上游服务正常运行，网络延迟或中断不会导致超时。
2. 检查可能导致延迟的长时间运行的操作或数据库查询。
3. 重新配置或优化网关设置，调整超时设置。

确保每次更新后都能监控服务的稳定性，并且维护好日志记录和监控系统，以便在问题发生时快速作出反应。通常情况下，排除前端请求问题后，需要将这些信息提供给后端开发团队，共同解决问题。

## 性能分析调试

性能分析是前端开发中的一个重要部分，它帮助我们识别和解决网页或应用程序的性能瓶颈。以下是一些常用的性能分析相关的调试方法和工具，以Chrome DevTools为例：

### 1. Performance面板

- **用途**：浏览器的性能分析工具，用于记录和查看网站在加载和运行过程中的性能信息。

- 具体方法

  ：

  - 打开DevTools，切换到"Performance"面板。
  - 点击录制按钮开始记录，执行需要分析的操作，点击停止。
  - 查看时间线和火焰图，其中包括了JS执行时间、渲染活动、绘制和复合操作、布局和回流等信息。
  - 点击各个部分来进行详细的分析，比如JS堆栈调用、减少回流和重绘等。

### 2. Network面板

- **用途**：分析页面加载过程中发起的所有网络请求，包括文件下载、API调用等。

- 具体方法

  ：

  - 打开DevTools，切换到"Network"面板。
  - 刷新页面，查看页面加载期间的所有网络请求。
  - 分析请求的加载时间、大小和响应时间，寻找慢请求或未优化的资源。
  - 使用"Waterfall"（瀑布图）查看请求间的依赖关系和加载顺序。

### 3. Lighthouse

- **用途**：一个集成在Chrome DevTools中的自动化工具，用于提升网页的质量，包含性能、可访问性、PWA、SEO等方面的分析。

- 具体方法

  ：

  - 打开DevTools，切换到"Lighthouse"面板。
  - 选择你想要运行的审计类别（如性能），点击"Generate report"。
  - 查看生成的报告，实施推荐的优化建议。

### 4. Memory面板

- **用途**：监视网页的内存使用情况，识别内存泄漏或过度的内存占用。

- 具体方法

  ：

  - 打开DevTools，切换到"Memory"面板。
  - 使用"Heap snapshot"来捕获JS堆的快照，分析内存占用。
  - 使用"Allocation instrumentation on timeline"记录内存分配情况，寻找异常的内存增长。

### 5. Coverage面板

- **用途**：分析页面加载过程中实际使用和未使用的CSS和JS代码，帮助优化加载时间。

- 具体方法

  ：

  - 打开DevTools，切换到"More tools" > "Coverage"。
  - 点击"Reload page and start capturing coverage"开始记录。
  - 查看代码覆盖率报告，找出和移除未使用的代码。

在采取任何优化措施之前，应使用这些工具和方法进行深入的性能分析。这样你就能有针对性地优化，避免盲目调整带来的负面影响。

## 预期之外的错误

> 有些错误是因为我们书写逻辑存在问题，导致页面的内容与预期的不一致，这种情况下，不会报错。

自己比较常用的方式，

### 二分注释法

> 目标：Bug是编码错误导致的。
>
> 推导1：删除掉所有的代码，应该不会有Bug存在。
>
> 推导2：删除掉错误的代码，应该不会有Bug存在。

程序员最头疼的Bug，没有报错，没有任何提示。

步骤：

1. 通过不断注释代码，观察程序是否恢复正常
2. 注释掉部分代码后，程序正常，证明该部分代码有Bug
3. 在Bug部分，继续小部分的注释，观察程序是否正常。
4. 持续1-3步骤，定位出Bug位置。

## 面试题

### 平时怎么调试代码，怎么debug？ 

> 相关问题：
>
> - 平时用的调试方法
> - chrome调试工具,怎么定位问题，sourcemap

- CSS调试

  利用元素面板，定位到元素位置，查看元素的属性，或者调整元素的属性，完善问题

- JavaScript调试

  1. 利用控制台提示，定位到报错位置
  2. 利用控制台提示，查看报错的原因，分析报错的逻辑
  3. 明显的错误，自己修改
  4. 没有分析出来，根据情况，打断点
  5. 查看当前代码，所在的作用域链，调用栈等信息

- 网络错误的调试

  - 利用状态码分析出现问题的原因
  - 对比API文档，找出请求出现的问题
  - 利用控制台信息，定位到源码，修改代码

### 调试环境中查看内存泄漏

### 页面加载白屏问题，排查、调试的方法，怎么避免

- 线上调试和本地调试有什么区别
- 如果开发者的页面打开正常，客户端的是白屏，怎么定位错误(循序渐进地引导我回答，首先是回答了看浏览器调试功能文件请求有没有正常获取到，如果正常我会在vue里面的生命周期之类的输出一些东西定位问题，毕竟客户端不能打断点，面试官说Chrome是可以的，让我可以了解一下)
- 前端调优，加载慢分析原因，怎么搞
- 前端错误定位？
- 浏览器性能调试api？